// Submits data to the controller when the input values change
// and replaces the output with the data generated by the controller.
var formatId = null;

$(document).ready(function () {
    $("#format_id").bind("change", function () {
        formatId = event.srcElement.value;
        reloadOutput();
    });

    $("#data_samples_input").bind("change", function() {
        reloadOutput();
    });

    var generateSampleButton = $( "#generate_sample_button" );

    // Prevent receiving same click event twice
    generateSampleButton.unbind( "click" );

    generateSampleButton.click(function (event) {
        event.preventDefault();
        generateData();
    });
});

var reloadOutput = function() {
    var dataSample = $('#data_samples_input').val();
    var shortenedSample = (dataSample.toString()).replace(/(^[ \t]*\n)/gm, "");
    $.ajax('/preview', {
        method: 'GET',
        dataType: "json",
        data: {
            format_id: formatId,
            data_sample: shortenedSample
        },
        success: function(data) {
            // noinspection JSUnresolvedVariable
                document.getElementById("outputdiv").innerHTML = data.preview;
        },
        error: function (e) {
            console.log("Error");
            console.log(e.toString());
        }
    });
};

var generateData = function() {
    $.ajax('/preview/sample', {
        method: 'GET',
        dataType: "json",
        data: {
            format_id: formatId
        },
        success: function(data) {
            // noinspection JSUnresolvedVariable
            $('#data_samples_input').val(data.sample);
            reloadOutput();
        },
        error: function (e) {
            console.log("Error");
            console.log(e.toString());
        }
    });
};