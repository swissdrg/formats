// Submits data to the controller when the input values change
// and replaces the output with the data generated by the controller.
$(document).ready(function () {
    $("#format_id").bind("change", function () {
        updateOutput();
    });

    $('#data_samples_input').on('input', function(){
        updateOutput();
    });

    var generateSampleButton = $("#generate_sample_button");
    // Prevent receiving same click event twice
    generateSampleButton.unbind( "click" );

    generateSampleButton.click(function (event) {
        event.preventDefault();
        generateData();
    });
});

var updateButtonDisabledStatus = function(){
    var formatId = $('#format_id').val();
    if (formatId == null || formatId.toString() ==='') {
        $("#generate_sample_button").attr('disabled', 'disabled');
    } else {
        $("#generate_sample_button").removeAttr('disabled');
    }
};

var updateOutput = function() {
    var formatId = $('#format_id').val();
    var dataSample = $('#data_samples_input').val();
    var shortenedSample = (dataSample.toString()).replace(/(^[ \t]*\n)/gm, "");

    updateButtonDisabledStatus();

    if (formatId == null || formatId.toString() === '') {
        $("#outputdiv").html("Format is not chosen yet, please select a format!");
        return;
    } else if (dataSample == null || dataSample.toString() === '') {
        $("#outputdiv").html("Input is empty, please provide some input!");
        return;
    }

    $.ajax('/preview', {
        method: 'GET',
        dataType: "json",
        data: {
            format_id: formatId,
            data_sample: shortenedSample
        },
        success: function(data) {
            // noinspection JSUnresolvedVariable
            $("#outputdiv").html(data.preview);
        },
        error: function (e) {
            console.log("Error");
            console.log(e.toString());
        }
    });
};

var generateData = function() {
    $.ajax('/preview/sample', {
        method: 'GET',
        dataType: "json",
        data: {
            format_id: $('#format_id').val()
        },
        success: function(data) {
            // noinspection JSUnresolvedVariable
            $('#data_samples_input').val(data.sample);
            updateOutput();
        },
        error: function (e) {
            console.log("Error");
            console.log(e.toString());
        }
    });
};